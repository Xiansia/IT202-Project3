<!DOCTYPE html>
<html>
<body onload="Title();">

<canvas id="myCanvas" width="1000" height="500" style="border:1px solid #d3d3d3;">
Your browser does not support the HTML5 canvas tag.</canvas><br>
    
<button onclick="start()" align="center">Start Game</button>
<button onmouseup="moveup()" onmousedown="clearMove()">Up</button>
<button onmouseup="movedown()" onmousedown="clearMove()">Down</button>
<br>
<img id="DeadTrex" src="DeadTrex.jpg" alt="Dead">Dimensions of this sprite is 40 x 43<br>
<img id="DuckTrex1" src="DuckTrex1.jpg" alt="Duck1">Dimensions of this sprite is 55 x 26
<img id="DuckTrex2" src="DuckTrex2.jpg" alt="Duck2" style="display:none;">    
<img id="RunTrex1" src="RunTrex1.jpg" alt="Run1" style="display:none;">    
<img id="RunTrex2" src="RunTrex2.jpg" alt="Run2" style="display:none;">  
<img id="IdleTrex" src="IdleTrex.jpg" alt="Idle" style="display:none;">    

    

<script>
var player;

var GameArea = {
    canvas : document.getElementById("myCanvas"),   
    frameNo : 0,
    clearCanvas : function(){
        var ctx = this.canvas.getContext("2d");
        ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
    },
    drawFloor : function(){
        var ctx = this.canvas.getContext("2d");
        ctx.moveTo(0, 400);
        ctx.lineTo(1000,400);
        ctx.stroke();
    },
    startGame : function(){  
        var ctx = this.canvas.getContext("2d");
        this.clearCanvas();
        
    
        player = new Trex(40, 43, 100, 356);
        player.update();
    
        var img2 = document.getElementById("DuckTrex1");
        ctx.drawImage(img2, 200, 373);
        GameArea.drawFloor();
        
        
        window.addEventListener('keydown', function(e) {
            e.preventDefault();
            console.log(e);
            switch (e.keyCode) {
                case 37:
                    player.speedX= -5;
                    break;
                case 38:
                    if(player.speedY == 0){
                        player.speedY = -10;
                    }
                    break;
                case 39:
                    player.speedX= 5;
                    break;
                case 40:
                    player.speedY= 1;
                    player.duck = true;
                    break;
            }
            console.log("Key down happened");
        })
        window.addEventListener('keyup', function (e) {
            switch (e.keyCode) {
                case 37:
                    player.speedX= 0;
                    break;
                case 38:
                    //player.speedY = -5;
                    break;
                case 39:
                    player.speedX= 0;
                    break;
                case 40:
                    player.duck = false;
                    break;
            }
            console.log("Key up happened");
        })
        window.requestAnimationFrame(updateGameArea);
        console.log("After request");
    },
    updateScore : function(){
        var ctx = this.canvas.getContext("2d");
        ctx.font = "30px Arial";
        ctx.fillText("Score: " + Math.floor(this.frameNo/2), 25, 50);
    }
    

}
function start() {
    GameArea.clearCanvas();
    GameArea.startGame();
}
function Title(){
    var ctx = GameArea.canvas.getContext("2d");
    ctx.font = "30px Times New Roman";
    ctx.fillText("T-Rex Game", 400, 150);
    
    //Style Title Later
    GameArea.drawFloor();
}
    
var run1 = document.getElementById("RunTrex1");
var run2 = document.getElementById("RunTrex2")
var duck1 = document.getElementById("DuckTrex1");
var duck2 = document.getElementById("DuckTrex2");
var dead = document.getElementById("DeadTrex");
var idle = document.getElementById("IdleTrex");
    
function Trex(width, height, x, y) {
    this.width = width;
    this.height = height;
    this.x = x;
    this.y = y;
    this.speedX = 0;
    this.speedY = 0;
    this.gravity = .5;
    this.gravitySpeed = 0;
    this.currentSprite = null;
    this.frameNo = 0;
    this.duck = false;
    this.lives = 3;
    var ctx = GameArea.canvas.getContext("2d");
    
    this.update = function() {
        this.frameNo++;
        if(this.currentSprite == null){
            this.currentSprite = idle;
            console.log("Player->null");
        }
        //Change sprite depending on action. Trex is jumping here
        if(this.y < 356){
            this.width = 40;
            this.height = 43;
            this.currentSprite = idle;
        }
        else{
            //Trex is running or ducking
            if(this.frameNo < 5){
                if(this.duck){
                    this.width = 55;
                    this.height = 26;
                    this.y = this.y + 17;
                    this.currentSprite = duck2;
                }
                else{
                    this.width = 40;
                    this.height = 43;
                    this.currentSprite = run2;    
                }
                
            }
            else{
                if(this.duck){
                    this.width = 55;
                    this.height = 26;
                    this.y = this.y + 17;
                    this.currentSprite = duck1;
                }
                else{
                    this.width = 40;
                    this.height = 43;
                    this.currentSprite = run1;    
                }
                if(this.frameNo > 10){
                    this.frameNo = 0;
                }
            }

        }
        ctx.drawImage(this.currentSprite, this.x, this.y, this.width, this.height);
        
    }
    this.newPos = function() {
        this.gravitySpeed += this.gravity;
        this.x += this.speedX;
        this.y += this.speedY + this.gravitySpeed;
        if(this.y > 356){
            this.y = 356;
            this.speedY = 0;
            this.gravitySpeed = 0;
        }
    }
}
function updateGameArea(){
    GameArea.clearCanvas();
    GameArea.drawFloor();
    player.newPos();
    player.update();
    window.requestAnimationFrame(updateGameArea);
    GameArea.frameNo++;
    GameArea.updateScore();
}
function clearMove(){
    player.speedY = 0;
    player.speedX = 0;
}

</script>
    
    
</body>
</html>